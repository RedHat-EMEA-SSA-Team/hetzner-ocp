Centos
yum -y install qemu-kvm libvirt virt-install bridge-utils
sudo yum update -y
systemctl enable libvirtd
systemctl start libvirtd


virt-install --connect qemu:///system --name rhel --virt-type kvm \
    --arch x86_64 --vcpus 1 --cpu host --ram 1024 --os-type linux \
    --os-variant rhel7.3 \
    --disk pool=default,format=qcow2,cache=none,io=native,size=12 \
    --disk pool=default,format=qcow2,cache=none,io=native,size=24 \
    --network default \
    --graphics vnc --noreboot \
    --location http://hetzner-static.s3-website-eu-west-1.amazonaws.com/rhel73 \
    --extra-args "ip=dhcp inst.ks=http://hetzner-static.s3-website-eu-west-1.amazonaws.com/ks/rhel-73-ocp.ks console=tty0 console=ttyS0,115200 quiet systemd.show_status=yes" \
    --noautoconsole

    iptables -t nat -I PREROUTING -p tcp -d 46.4.119.94 --dport 80 -j DNAT --to-destination 192.168.122.:80
    iptables -t nat -I PREROUTING -p tcp -d 46.4.119.94 --dport 443 -j DNAT --to-destination 192.168.122.123:443
    iptables -t nat -I PREROUTING -p tcp -d 46.4.119.94 --dport 8443 -j DNAT --to-destination 192.168.122.17:443
    iptables -I FORWARD -m state -d 192.168.122.0/24 --state NEW,RELATED,ESTABLISHED -j ACCEPT

    lineinfile: dest: /etc/resolv.conf state: present insertafter: '# Generated by NetworkManager' line: 'search cluster.local'

iptables -t nat -I PREROUTING -p tcp -d 213.133.99.90 --dport 80 -j DNAT --to-destination 192.168.122.95:80
iptables -t nat -I PREROUTING -p tcp -d 213.133.99.90 --dport 443 -j DNAT --to-destination 192.168.122.95:443
iptables -I FORWARD -m state -d 192.168.122.0/24 --state NEW,RELATED,ESTABLISHED -j ACCEPT
213.133.99.90

# hostPath
qemu-img create -f raw /var/lib/libvirt/images/docker-registry.img 100G
virsh attach-disk infranode01 --source /var/lib/libvirt/images/docker-registry.img --persistent --target vdc
mkfs.ext4 /dev/vdc
mkdir /var/hostpath
/dev/vdc   /var/hostpath  ext4    defaults    0 0
